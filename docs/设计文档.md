# r-ucosii设计文档

## 整体设计

分成两个接口，一个接口是对于c/rust的普通函数的，另一个接口是对于rust的异步函数的。

然而对于c/rust普通函数，我们对它进行包装，在接口内转为一个future 对象，从而将调度都统一到执行器进行。

后续可以通过宏或者接口中直接区别rust的普通函数和异步函数从而对于rust普通函数和异步函数进行合并

下面以表格形式给出各种情况的上下文切换情况：

| 当前执行现场 | 新执行现场       | 切换条件 | 是否需要保存上下文 | 是否需要恢复上下文 |
| ------------ | ---------------- | -------- | ------------------ | ------------------ |
| 协程         | 线程             | await    | 否                 | 是                 |
| 协程         | 协程（未被打断） | await    | 否                 | 否                 |
| 协程         | 协程（被打断）   | await    | 否                 | 是                 |
|              |                  |          |                    |                    |
| 协程/线程    | 线程             | 非await  | 是                 | 是                 |
| 协程/线程    | 协程（未被打断） | 非await  | 是                 | 否                 |
| 协程/线程    | 协程（被打断）   | 非await  | 是                 | 是                 |

